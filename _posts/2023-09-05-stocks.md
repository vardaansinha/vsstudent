---
toc: true
comments: true
layout: post
title: Stock Predictor
courses: { csa: {week: 3} }
type: hacks
---

<html>
<head>
  <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
</head>
<body>

<div>
  <!-- JS user input, allows for users to put in a stock of their choice -->
  <label for="stockInput">Enter Stock Symbol: </label>
  <input type="text" id="stockInput" placeholder="e.g., MSFT">
  <!-- generates graph, fetches data from API -->
  <button onclick="fetchData()">Generate Graph</button>
</div>

<div id="myPlot" style="width:100%;max-width:700px"></div>

<script>
// this is the function where stock data is fetched from api
async function fetchData() {
  // user input is actually read here
  const stockSymbol = document.getElementById('stockInput').value;
  // vantage API url for weekly data
  const url = `https://alpha-vantage.p.rapidapi.com/query?function=TIME_SERIES_WEEKLY_ADJUSTED&symbol=${stockSymbol}&datatype=json`;
  // GET request, code from RapidAPI 
  const options = {
    method: 'GET',
    headers: {
      'X-RapidAPI-Key': '115318933dmsh6d4dd26b9c05b57p138eb6jsn5766c7fe61da',
      'X-RapidAPI-Host': 'alpha-vantage.p.rapidapi.com'
    }
  };

  try {
    // fetches the stock data from the API
    const response = await fetch(url, options);
    const result = await response.json();

    // takes the weekly dates from the API and shows the closing day stock prices based on the API response
    const weeklyData = result['Weekly Adjusted Time Series'];
    const dates = Object.keys(weeklyData);
    const prices = dates.map((date) => parseFloat(weeklyData[date]['5. adjusted close']));

    
    const data = [{
      x: dates,
      y: prices,
      type: "scatter",
      mode: "lines",
      name: "Stock Prices"
    }];

    // calculating the actual linear regression
    const xValues = dates.map((date, index) => index);
    const yValues = prices;
    const regression = linearRegression(xValues, yValues);

    // code behind actually generating the regression line, creating the data
    const regressionLine = {
      x: dates,
      y: regression.line.map((slope, index) => slope * index + regression.intercept),
      type: "scatter",
      mode: "lines",
      name: "Regression Line",
      line: {
        dash: 'solid',
        color: 'black'
      }
    };

    // regression line data is being added to the graph
    data.push(regressionLine);

    const layout = {
      xaxis: { title: "Date" },
      yaxis: { title: "Stock Price" },
      title: `${stockSymbol} Weekly Adjusted Stock Prices Over Time`
    };

    Plotly.newPlot("myPlot", data, layout);
  } catch (error) {
    console.error(error);
  }
}

// function to calculate the linear regression

function linearRegression(x, y) {
  // retrieves 'n' data points of length x or y
  const n = x.length;
  let sumX = 0;
  let sumY = 0;
  let sumXY = 0;
  let sumX2 = 0;

  // initializes the following variables so that sums can be kept
  for (let i = 0; i < n; i++) {
    sumX += x[i]; 
    sumY += y[i];
    sumXY += x[i] * y[i];
    sumX2 += x[i] * x[i];
  }

  // this is the actual slope calculation using the variables already initialized above. 
  const slope = (n * sumXY - sumX * sumY) / (n * sumX2 - sumX * sumX);
  const intercept = (sumY - slope * sumX) / n;

  return {
    // creates an array that represents the regression, constant slope
    line: Array.from({ length: n }, (_, i) => slope),
    // returns slope and y-intercept of regression line
    slope,
    intercept
  };
}
</script>

</body>
</html>
