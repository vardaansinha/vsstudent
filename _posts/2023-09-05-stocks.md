---
toc: true
comments: true
layout: post
title: Stock Predictor
courses: { csa: {week: 3} }
type: hacks
---

<html>
<head>
  <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
  <script src="https://cdn.plot.ly/regression/2.0.0/regression.min.js"></script>
</head>
<body>

<div>
  <label for="stockInput">Enter Stock Symbol: </label>
  <input type="text" id="stockInput" placeholder="e.g., MSFT">
  <button onclick="fetchData()">Generate Graph</button>
</div>

<div id="myPlot" style="width:100%;max-width:700px"></div>

<script>
async function fetchData() {
  const stockSymbol = document.getElementById('stockInput').value;
  const url = `https://alpha-vantage.p.rapidapi.com/query?function=TIME_SERIES_WEEKLY_ADJUSTED&symbol=${stockSymbol}&datatype=json`;
  const options = {
    method: 'GET',
    headers: {
      'X-RapidAPI-Key': '115318933dmsh6d4dd26b9c05b57p138eb6jsn5766c7fe61da',
      'X-RapidAPI-Host': 'alpha-vantage.p.rapidapi.com'
    }
  };

  try {
    const response = await fetch(url, options);
    const result = await response.json();

    // Extract dates and adjusted closing prices from the API response
    const weeklyData = result['Weekly Adjusted Time Series'];
    const dates = Object.keys(weeklyData);
    const prices = dates.map((date) => parseFloat(weeklyData[date]['5. adjusted close']));

    // Calculate the regression line
    const regression = require('regression');
    const regressionData = dates.map((date, index) => [index, prices[index]]);
    const result = regression.linear(regressionData);
    const regressionLine = result.points.map((point) => [dates[point[0]], point[1]]);

    // Define Data
    const data = [
      {
        x: dates,
        y: prices,
        type: "scatter",
        mode: "lines",
        name: "Stock Prices"
      },
      {
        x: regressionLine.map((point) => point[0]),
        y: regressionLine.map((point) => point[1]),
        type: "scatter",
        mode: "lines",
        name: "Regression Line",
        line: { color: 'blue' }
      }
    ];

    // Define Layout
    const layout = {
      xaxis: { title: "Date" },
      yaxis: { title: "Stock Price" },
      title: `${stockSymbol} Weekly Adjusted Stock Prices with Linear Predictor`
    };

    // Display using Plotly
    Plotly.newPlot("myPlot", data, layout);
  } catch (error) {
    console.error(error);
  }
}
</script>

</body>
</html>
