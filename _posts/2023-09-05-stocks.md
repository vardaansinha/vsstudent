---
toc: true
comments: true
layout: post
title: Stock Predictor
courses: { csa: {week: 3} }
type: hacks
---

<html>
<head>
  <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
</head>
<body>

<div>
  <label for="stockInput">Enter Stock Symbol: </label>
  <input type="text" id="stockInput" placeholder="e.g., MSFT">
  <button onclick="fetchData()">Generate Graph</button>
</div>

<div id="myPlot" style="width:100%;max-width:700px"></div>

<script>
async function fetchData() {
  const stockSymbol = document.getElementById('stockInput').value;
  const url = `https://alpha-vantage.p.rapidapi.com/query?function=TIME_SERIES_WEEKLY_ADJUSTED&symbol=${stockSymbol}&datatype=json`;
  const options = {
    method: 'GET',
    headers: {
      'X-RapidAPI-Key': '115318933dmsh6d4dd26b9c05b57p138eb6jsn5766c7fe61da',
      'X-RapidAPI-Host': 'alpha-vantage.p.rapidapi.com'
    }
  };

  try {
    const response = await fetch(url, options);
    const result = await response.json();

    // Extract dates and adjusted closing prices from the API response
    const weeklyData = result['Weekly Adjusted Time Series'];
    const dates = Object.keys(weeklyData);
    const prices = dates.map((date) => parseFloat(weeklyData[date]['5. adjusted close']));

    // Define Data
    const data = [{
      x: dates,
      y: prices,
      type: "scatter",
      mode: "lines",
      name: "Stock Prices"
    }];

    // constant definition (linear regression function referred to)
    const xValues = dates.map((date, index) => index);
    const yValues = prices;
    const regression = linearRegression(xValues, yValues);

    // actual regression design 
    const regressionLine = {
      x: dates,
      y: regression.line.map((slope, index) => slope * index + regression.intercept),
      type: "scatter",
      mode: "lines",
      name: "Regression Line",
      line: {
        dash: 'solid',
        color: 'black'
      }
    };

    data.push(regressionLine);

    // Define Layout
    const layout = {
      xaxis: { title: "Date" },
      yaxis: { title: "Stock Price" },
      title: `${stockSymbol} Weekly Adjusted Stock Prices Over Time`
    };

    // Display using Plotly
    Plotly.newPlot("myPlot", data, layout);
  } catch (error) {
    console.error(error);
  }
}

// linear regression calculation

function linearRegression(x, y) {
  const n = x.length;
  let sumX = 0;
  let sumY = 0;
  let sumXY = 0;
  let sumX2 = 0;

  for (let i = 0; i < n; i++) {
    sumX += x[i];
    sumY += y[i];
    sumXY += x[i] * y[i];
    sumX2 += x[i] * x[i];
  }

  const slope = (n * sumXY - sumX * sumY) / (n * sumX2 - sumX * sumX);
  const intercept = (sumY - slope * sumX) / n;

  return {
    line: Array.from({ length: n }, (_, i) => slope),
    slope,
    intercept
  };
}
</script>

</body>
</html>
